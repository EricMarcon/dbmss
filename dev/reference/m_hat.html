<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Estimation of the m function — mhat • dbmss</title>

<!-- favicons -->
<link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png" />
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png" />
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png" />
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png" />

<!-- jquery -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>
<!-- Bootstrap -->

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous" />

<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script>

<!-- bootstrap-toc -->
<link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script>

<!-- Font Awesome icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous" />

<!-- clipboard.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script>

<!-- headroom.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script>

<!-- pkgdown -->
<link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script>


<!-- docsearch -->
<script src="../docsearch.js"></script>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/docsearch.js/2.6.3/docsearch.min.css" integrity="sha256-QOSRU/ra9ActyXkIBbiIB144aDBdtvXBcNc3OTNuX/Q=" crossorigin="anonymous" />
<link href="../docsearch.css" rel="stylesheet">
<script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/jquery.mark.min.js" integrity="sha256-4HLtjeVgH0eIB3aZ9mLYF6E8oU5chNdjU6p6rrXpl9U=" crossorigin="anonymous"></script>



<meta property="og:title" content="Estimation of the m function — mhat" />
<meta property="og:description" content="Estimates the m function" />
<meta property="og:image" content="https://ericmarcon.github.io/dbmss/logo.png" />


<meta name="robots" content="noindex">

<!-- mathjax -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->



  </head>

  <body data-spy="scroll" data-target="#toc">
    <div class="container template-reference-topic">
      <header>
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">dbmss</a>
        <span class="version label label-danger" data-toggle="tooltip" data-placement="bottom" title="In-development version">2.7-4.9005</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="../index.html">
    <span class="fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../articles/dbmss.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="../articles/articles/bandwidth.html">Bandwidth choice</a>
    </li>
    <li>
      <a href="../articles/articles/reference.html">dbmss Package Reference</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://github.com/EricMarcon/dbmss/">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
      
      <form class="navbar-form navbar-right hidden-xs hidden-sm" role="search">
        <div class="form-group">
          <input type="search" class="form-control" name="search-input" id="search-input" placeholder="Search..." aria-label="Search for..." autocomplete="off">
        </div>
      </form>
      
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header>

<div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Estimation of the m function</h1>
    
    <div class="hidden name"><code>m_hat.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>Estimates the <em>m</em> function</p>
    </div>

    <pre class="usage"><span class='fu'>mhat</span><span class='op'>(</span><span class='va'>X</span>, r <span class='op'>=</span> <span class='cn'>NULL</span>, <span class='va'>ReferenceType</span>, NeighborType <span class='op'>=</span> <span class='va'>ReferenceType</span>,
    CaseControl <span class='op'>=</span> <span class='cn'>FALSE</span>, Original <span class='op'>=</span> <span class='cn'>TRUE</span>, Approximate <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/ifelse.html'>ifelse</a></span><span class='op'>(</span><span class='va'>X</span><span class='op'>$</span><span class='va'>n</span> <span class='op'>&lt;</span> <span class='fl'>10000</span>, <span class='fl'>0</span>, <span class='fl'>1</span><span class='op'>)</span>,
    Adjust <span class='op'>=</span> <span class='fl'>1</span>, MaxRange <span class='op'>=</span> <span class='st'>"ThirdW"</span>, Individual <span class='op'>=</span> <span class='cn'>FALSE</span>, CheckArguments <span class='op'>=</span> <span class='cn'>TRUE</span><span class='op'>)</span></pre>

    <h2 class="hasAnchor" id="arguments"><a class="anchor" href="#arguments"></a>Arguments</h2>
    <table class="ref-arguments">
    <colgroup><col class="name" /><col class="desc" /></colgroup>
    <tr>
      <th>X</th>
      <td><p>A weighted, marked planar point pattern (<code><a href='wmppp.object.html'>wmppp.object</a></code>) or a <code><a href='Dtable.html'>Dtable</a></code> object.</p></td>
    </tr>
    <tr>
      <th>r</th>
      <td><p>A vector of distances. If <code>NULL</code>, a default value is set: 512 equally spaced values are used, from the smallest distance to the range defined by <code>MaxRange</code>. the between points to half the diameter of the window.</p></td>
    </tr>
    <tr>
      <th>ReferenceType</th>
      <td><p>One of the point types.</p></td>
    </tr>
    <tr>
      <th>NeighborType</th>
      <td><p>One of the point types. By default, the same as reference type.</p></td>
    </tr>
    <tr>
      <th>CaseControl</th>
      <td><p>Logical; if <code>TRUE</code>, the case-control version of <em>M</em> is computed. <em>ReferenceType</em> points are cases, <em>NeighborType</em> points are controls.</p></td>
    </tr>
    <tr>
      <th>Original</th>
      <td><p>Logical; if <code>TRUE</code> (by default), the original bandwidth selection by Duranton and Overman (2005) following Silverman (1986: eq 3.31) is used. If <code>FALSE</code>, it is calculated following Sheather and Jones (1991), <em>i.e.</em> the state of the art. See <code><a href='https://rdrr.io/r/stats/bandwidth.html'>bw.SJ</a></code> for more details.</p></td>
    </tr>
    <tr>
      <th>Approximate</th>
      <td><p>if not 0 (1 is a good choice), exact distances between pairs of points are rounded to 1024 times <code>Approximate</code> single values equally spaced between 0 and the largest distance. This technique (Scholl and Brenner, 2015) allows saving a lot of memory when addressing large point sets (the default value is 1 over 10000 points). Increasing <code>Approximate</code> allows better precision at the cost of proportional memory use. Ignored if <code>X</code> is a <code><a href='Dtable.html'>Dtable</a></code> object.</p></td>
    </tr>
    <tr>
      <th>Adjust</th>
      <td><p>Force the automatically selected bandwidth (following <code>Original</code>) to be multiplied by <code>Adjust</code>. Setting it to values lower than one (1/2 for example) will sharpen the estimation.</p></td>
    </tr>
    <tr>
      <th>MaxRange</th>
      <td><p>The maximum value of <code>r</code> to consider, ignored if <code>r</code> is not <code>NULL</code>. Default is "ThirdW", one third of the diameter of the window. Other choices are "HalfW", and "QuarterW" and "D02005".
  "HalfW", and "QuarterW" are for half or the quarter of the diameter of the window.
  "D02005" is for the median distance observed between points, following Duranton and Overman (2005). "ThirdW" should be close to "DO2005" but has the advantage to be independent of the point types chosen as <code>ReferenceType</code> and <code>NeighborType</code>, to simplify comparisons between different types. "D02005" is approximated by "ThirdW" if <code>Approximate</code> is not 0.
  If <code>X</code> is a <code><a href='Dtable.html'>Dtable</a></code> object, the diameter of the window is taken as the max distance between points.</p></td>
    </tr>
    <tr>
      <th>Individual</th>
      <td><p>Logical; if <code>TRUE</code>, values of the function around each individual point are returned.</p></td>
    </tr>
    <tr>
      <th>CheckArguments</th>
      <td><p>Logical; if <code>TRUE</code>, the function arguments are verified. Should be set to <code>FALSE</code> to save time in simulations for example, when the arguments have been checked elsewhere.</p></td>
    </tr>
    </table>

    <h2 class="hasAnchor" id="details"><a class="anchor" href="#details"></a>Details</h2>

    <p><em>m</em> is a weighted, density, relative measure of a point pattern structure (Lang <em>et al.</em>, 2014). Its value at any distance is the ratio of neighbors of the <em>NeighborType</em> to all points around <em>ReferenceType</em> points, normalized by its value over the windows.</p>  
<p>The number of neighbors at each distance is estimated by a Gaussian kernel whose bandwith is chosen optimally according to Silverman (1986: eq 3.31). It can be sharpened or smoothed by multiplying it by <code>Adjust</code>. The bandwidth of Sheather and Jones (1991) would be better but it is very slow to calculate for large point patterns and it sometimes fails. It is often sharper than that of Silverman.</p>  
<p>If <code>X</code> is not a <code><a href='Dtable.html'>Dtable</a></code> object, the maximum value of <code>r</code> is obtained from the geometry of the window rather than caculating the median distance between points as suggested by Duranton and Overman (2005) to save (a lot of) calculation time.</p>  
<p>If <em>CaseControl</em> is <code>TRUE</code>, then <em>ReferenceType</em> points are cases and <em>NeighborType</em> points are controls. The univariate concentration of cases is calculated as if <em>NeighborType</em> was equal to <em>ReferenceType</em>, but only controls are considered when counting all points around cases (Marcon et al., 2012). This makes sense when the sampling design is such that all points of <em>ReferenceType</em> (the cases) but only a sample of the other points (the controls) are recorded. Then, the whole distribution of points is better represented by the controls alone.</p>
    <h2 class="hasAnchor" id="value"><a class="anchor" href="#value"></a>Value</h2>

    <p>An object of class <code>fv</code>, see <code>fv.object</code>, which can be plotted directly using <code>plot.fv</code>.</p>
<p>If <code>Individual</code> is set to <code>TRUE</code>, the object also contains the value of the function around each individual <em>ReferenceType</em> point taken as the only reference point. The column names of the <code>fv</code> are "m_" followed by the point names, i.e. the row names of the marks of the point pattern.</p>
    <h2 class="hasAnchor" id="note"><a class="anchor" href="#note"></a>Note</h2>

    <p>Estimating <em>m</em> relies on calculating distances, exactly or approximately (if <code>Approximate</code> is not 0).
  Then distances are smoothed by estimating their probability density.
  In contrast with <code><a href='Kdhat.html'>Kdhat</a></code>, reflection is not used to estimate density close to the lowest distance.
  The same kernel estimation is applied to the distances from reference points of neighbor points and of all points.
  Since <em>m</em> is a relative function, a ratio of densities is calculated, that makes the features of the estimation vanish.</p>  
<p>Density estimation heavily relies on the bandwith.
  Starting from version 2.7, the optimal bandwith is computed from the distribution of distances between pairs of points up to twice the maximum distance considered.
  The consequence is that choosing a smaller range of distances in argument <code>r</code> results in less smoothed $m$ values.
  The default values (<code>r = NULL</code>, <code>MaxRange = "ThirdW"</code>) are such that almost all the pairs of points (except those more than 2/3 of the window diameter apart) are taken into account to determine the bandwith.</p>
    <h2 class="hasAnchor" id="references"><a class="anchor" href="#references"></a>References</h2>

    <p>Duranton, G. and Overman, H. G. (2005). Testing for Localisation Using Micro-Geographic Data. <em>Review of Economic Studies</em> 72(4): 1077-1106.</p>
<p>Lang G., Marcon E. and Puech F. (2014) Distance-Based Measures of Spatial Concentration: Introducing a Relative Density Function. <em>HAL</em> 01082178, 1-18.</p>
<p>Marcon, E., F. Puech and S. Traissac (2012). Characterizing the relative spatial structure of point patterns. <em>International Journal of Ecology</em> 2012(Article ID 619281): 11.</p>
<p>Scholl, T. and Brenner, T. (2015) Optimizing distance-based methods for large data sets, <em>Journal of Geographical Systems</em> 17(4): 333-351.</p>
<p>Sheather, S. J. and Jones, M. C. (1991) A reliable data-based bandwidth selection method for kernel density estimation. <em>Journal of the Royal Statistical Society series B</em>, 53, 683-690.</p>
<p>Silverman, B. W. (1986). <em>Density estimation for statistics and data analysis</em>. Chapman and Hall, London.</p>
    <h2 class="hasAnchor" id="see-also"><a class="anchor" href="#see-also"></a>See also</h2>

    <div class='dont-index'><p><code><a href='mEnvelope.html'>mEnvelope</a></code>, <code><a href='Kdhat.html'>Kdhat</a></code></p></div>

    <h2 class="hasAnchor" id="examples"><a class="anchor" href="#examples"></a>Examples</h2>
    <pre class="examples"><div class='input'><span class='fu'><a href='https://rdrr.io/r/utils/data.html'>data</a></span><span class='op'>(</span><span class='va'>paracou16</span><span class='op'>)</span>
<span class='fu'>autoplot</span><span class='op'>(</span><span class='va'>paracou16</span><span class='op'>)</span>
</div><div class='img'><img src='m_hat-1.png' alt='' width='700' height='433' /></div><div class='input'>
<span class='co'># Calculate M</span>
<span class='fu'>autoplot</span><span class='op'>(</span><span class='fu'>mhat</span><span class='op'>(</span><span class='va'>paracou16</span>, , <span class='st'>"V. Americana"</span>, <span class='st'>"Q. Rosea"</span><span class='op'>)</span><span class='op'>)</span>
</div><div class='img'><img src='m_hat-2.png' alt='' width='700' height='433' /></div></pre>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top">
      <h2 data-toc-skip>Contents</h2>
    </nav>
  </div>
</div>


      <footer>
      <div class="copyright">
  <p>Developed by Eric Marcon, Gabriel Lang, Stephane Traissac, Florence Puech.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
   </div>

  
<script src="https://cdnjs.cloudflare.com/ajax/libs/docsearch.js/2.6.1/docsearch.min.js" integrity="sha256-GKvGqXDznoRYHCwKXGnuchvKSwmx9SRMrZOTh2g4Sb0=" crossorigin="anonymous"></script>
<script>
  docsearch({
    
    
    apiKey: '34d07893d7877757953d7bd46f236a5e',
    indexName: 'dbmss',
    inputSelector: 'input#search-input.form-control',
    transformData: function(hits) {
      return hits.map(function (hit) {
        hit.url = updateHitURL(hit);
        return hit;
      });
    }
  });
</script>



  </body>
</html>


