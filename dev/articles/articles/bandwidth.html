<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Bandwidth choice • dbmss</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../../apple-touch-icon-60x60.png">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../../bootstrap-toc.css">
<script src="../../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../../pkgdown.css" rel="stylesheet">
<script src="../../pkgdown.js"></script><!-- docsearch --><script src="../../docsearch.js"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/docsearch.js/2.6.3/docsearch.min.css" integrity="sha256-QOSRU/ra9ActyXkIBbiIB144aDBdtvXBcNc3OTNuX/Q=" crossorigin="anonymous">
<link href="../../docsearch.css" rel="stylesheet">
<script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/jquery.mark.min.js" integrity="sha256-4HLtjeVgH0eIB3aZ9mLYF6E8oU5chNdjU6p6rrXpl9U=" crossorigin="anonymous"></script><meta property="og:title" content="Bandwidth choice">
<meta property="og:description" content="dbmss">
<meta property="og:image" content="https://ericmarcon.github.io/dbmss/logo.png">
<meta name="robots" content="noindex">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../../index.html">dbmss</a>
        <span class="version label label-danger" data-toggle="tooltip" data-placement="bottom" title="In-development version">2.7-4.9007</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../../index.html">
    <span class="fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../../articles/dbmss.html">Get started</a>
</li>
<li>
  <a href="../../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../../articles/articles/bandwidth.html">Bandwidth choice</a>
    </li>
    <li>
      <a href="../../articles/articles/reference.html">dbmss Package Reference</a>
    </li>
  </ul>
</li>
<li>
  <a href="../../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/EricMarcon/dbmss/">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
<form class="navbar-form navbar-right hidden-xs hidden-sm" role="search">
        <div class="form-group">
          <input type="search" class="form-control" name="search-input" id="search-input" placeholder="Search..." aria-label="Search for..." autocomplete="off">
</div>
      </form>
      
    </div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="bandwidth_files/accessible-code-block-0.0.1/empty-anchor.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Bandwidth choice</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/EricMarcon/dbmss/blob/master/vignettes/articles/bandwidth.Rmd"><code>vignettes/articles/bandwidth.Rmd</code></a></small>
      <div class="hidden name"><code>bandwidth.Rmd</code></div>

    </div>

    
    
<div id="estimation-of-the-density-of-neighbors" class="section level1">
<h1 class="hasAnchor">
<a href="#estimation-of-the-density-of-neighbors" class="anchor"></a>Estimation of the density of neighbors</h1>
<p>The <span class="math inline">\(K_d\)</span> function <span class="citation">(Duranton and Overman 2005)</span> is the probability density to find a neighbor a given distance apart from a point of interest in a finite point process. The <span class="math inline">\(K^{emp}\)</span> function integrates the weights of points: it is the density probability to find an employee <span class="math inline">\(r\)</span> apart from an employee of interest. The <span class="math inline">\(m\)</span> function <span class="citation">(Lang, Marcon, and Puech 2014)</span> is the ratio of neighbors of interest at distance <span class="math inline">\(r\)</span> normalized by its value over the whole domain.</p>
<p>All those functions require smoothing the observed data: the probability to find a neighbor exactly <span class="math inline">\(r\)</span> apart from an arbitrary point is zero so neighbors around <span class="math inline">\(r\)</span> apart are considered. The <code>density</code> function is used for that purpose. It applies kernel density estimation. In <span class="math inline">\(dbmss\)</span>, Gaussian kernels are used following <span class="citation">Duranton and Overman (2005)</span>. Actually, the important choice in kernel density estimation is not the type of kernel but the bandwidth.</p>
<p>The bandwidth defines how close to <span class="math inline">\(r\)</span> the distance between two points must be to influence the estimation of the density at <span class="math inline">\(r\)</span>. A small bandwidth only considers the closest values so the estimation is close to the data. A large bandwidth considers more points and gives a smoother estimation.</p>
</div>
<div id="available-algorithms" class="section level1">
<h1 class="hasAnchor">
<a href="#available-algorithms" class="anchor"></a>Available algorithms</h1>
<p><span class="citation">Duranton and Overman (2005)</span>, in the original paper introducing the <span class="math inline">\(K_d\)</span> function, used the optimal bandwidth according to <span class="citation">Silverman (1986)</span>, i.e. the argument <code>bw = "nrd0"</code> of function <code>density</code>. This is the default choice in the functions of <span class="math inline">\(dbmss\)</span>, i.e. the argument <code>Original = TRUE</code> in <code>Kdhat</code>, <code>mhat</code> and similar functions.</p>
<p>A better choice may be <code>Original = FALSE</code> to apply the estimation of <span class="citation">Sheather and Jones (1991)</span>, i.e. the argument <code>bw = "SJ"</code> of function <code>density</code>, which has better theoretical support. The result is usually less smoothed.</p>
<p>The following figure shows this difference on the estimation of the <span class="math inline">\(m\)</span> function applied to the <code>paracou16</code> point set: the red curve is for the original estimation, the black one uses the Sheather and Jones bandwidth.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="st"><a href="https://github.com/EricMarcon/dbmss">"dbmss"</a></span><span class="op">)</span></code></pre></div>
<pre><code>## Loading required package: spatstat.core</code></pre>
<pre><code>## Loading required package: spatstat.data</code></pre>
<pre><code>## Loading required package: spatstat.geom</code></pre>
<pre><code>## spatstat.geom 1.65-5</code></pre>
<pre><code>## Loading required package: nlme</code></pre>
<pre><code>## Loading required package: rpart</code></pre>
<pre><code>## spatstat.core 1.65-5</code></pre>
<pre><code>## Loading required package: Rcpp</code></pre>
<pre><code>## Loading required package: ggplot2</code></pre>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Sheather and Jones bandwidth in black</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="fu"><a href="../../reference/mhat.html">mhat</a></span><span class="op">(</span><span class="va">paracou16</span>, , ReferenceType<span class="op">=</span><span class="st">"Q. Rosea"</span>, Original<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span>, main<span class="op">=</span><span class="st">""</span>, legend<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span>
<span class="co"># Original bandwith in red</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="fu"><a href="../../reference/mhat.html">mhat</a></span><span class="op">(</span><span class="va">paracou16</span>, , ReferenceType<span class="op">=</span><span class="st">"Q. Rosea"</span><span class="op">)</span>, col<span class="op">=</span><span class="st">"red"</span>, main<span class="op">=</span><span class="st">""</span>, add<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></code></pre></div>
<p><img src="bandwidth_files/figure-html/unnamed-chunk-1-1.png" width="700"></p>
</div>
<div id="data" class="section level1">
<h1 class="hasAnchor">
<a href="#data" class="anchor"></a>Data</h1>
<p>The data used by those algorithms is the set of distances between pairs of points. In <span class="math inline">\(dbmss\)</span>, only pairs of points less than twice the maximum value of <span class="math inline">\(r\)</span> are considered: very distant pairs of points are of little interest to estimate functions based on the number of neighbors of points. With the default arguments, almost all point pairs are included, except for the most distant ones, i.e. more than two thirds of the window’s diameter apart. If the user wants to focus on small distances, i.e. choose <span class="math inline">\(r\)</span> much less than the default value, then the most distant point pairs (more than twice the max value of <span class="math inline">\(r\)</span>) will be ignored, resulting in a smaller bandwidth and consequently a more acute (less smoothed) estimation of the functions. The following figure shows this effect on the estimation of the <span class="math inline">\(K_d\)</span> function applied to the <code>paracou16</code> point set. The default distance range is used for the black curve. The red curve is the same function estimated up to 30 meters only, resulting into a narrower bandwith: the curve of <span class="math inline">\(K_d\)</span> is less smoothed.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="fu"><a href="../../reference/Kdhat.html">Kdhat</a></span><span class="op">(</span><span class="va">paracou16</span>, , ReferenceType<span class="op">=</span><span class="st">"Q. Rosea"</span>, Original<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span>, ylim<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0.008</span><span class="op">)</span>, main<span class="op">=</span><span class="st">""</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="fu"><a href="../../reference/Kdhat.html">Kdhat</a></span><span class="op">(</span><span class="va">paracou16</span>, r<span class="op">=</span><span class="fl">0</span><span class="op">:</span><span class="fl">30</span> , ReferenceType<span class="op">=</span><span class="st">"Q. Rosea"</span>, Original<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span>, main<span class="op">=</span><span class="st">""</span>, col<span class="op">=</span><span class="st">"red"</span>, add<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></code></pre></div>
<p><img src="bandwidth_files/figure-html/unnamed-chunk-2-1.png" width="700"></p>
<p>The approximated algorithm used to calculate <span class="math inline">\(K_d\)</span> and <span class="math inline">\(m\)</span> retains point pairs up to twice the max value of <span class="math inline">\(r\)</span> and rounds their distances in 2048 (this number can be increased by the <code>Approximate</code> argument) equally-spaced values. This set of distances (actually, only those corresponding to at least a pair of points) is used to choose the bandwidth. Simulations show that the approximated algorithm yields bandwidths very similar to those obtained by exact computation.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Exact computation in black</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="fu"><a href="../../reference/Kdhat.html">Kdhat</a></span><span class="op">(</span><span class="va">paracou16</span>, , ReferenceType<span class="op">=</span><span class="st">"Q. Rosea"</span>, Original<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span>, main<span class="op">=</span><span class="st">""</span><span class="op">)</span>
<span class="co"># Approximated computation in green</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="fu"><a href="../../reference/Kdhat.html">Kdhat</a></span><span class="op">(</span><span class="va">paracou16</span>, , ReferenceType<span class="op">=</span><span class="st">"Q. Rosea"</span>, Original<span class="op">=</span><span class="cn">FALSE</span>, Approximate <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>, main<span class="op">=</span><span class="st">""</span>, col<span class="op">=</span><span class="st">"green"</span>, add<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></code></pre></div>
<p><img src="bandwidth_files/figure-html/unnamed-chunk-3-1.png" width="700"></p>
</div>
<div id="fine-tuning" class="section level1">
<h1 class="hasAnchor">
<a href="#fine-tuning" class="anchor"></a>Fine tuning</h1>
<p>The users can choose to multiply the bandwidth by argument <code>Adjust</code>. Values over 1 will smooth the density estimation; under 1, they will sharpen it.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Default bandwith in black</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="fu"><a href="../../reference/Kdhat.html">Kdhat</a></span><span class="op">(</span><span class="va">paracou16</span>, , ReferenceType<span class="op">=</span><span class="st">"Q. Rosea"</span>, Original<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span>, ylim<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0.008</span><span class="op">)</span>, main<span class="op">=</span><span class="st">""</span><span class="op">)</span>
<span class="co"># Adjusted (half) bandwidth in red</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="fu"><a href="../../reference/Kdhat.html">Kdhat</a></span><span class="op">(</span><span class="va">paracou16</span>, , ReferenceType<span class="op">=</span><span class="st">"Q. Rosea"</span>, Original<span class="op">=</span><span class="cn">FALSE</span>, Adjust <span class="op">=</span> <span class="fl">1</span><span class="op">/</span><span class="fl">2</span><span class="op">)</span>, main<span class="op">=</span><span class="st">""</span>, col<span class="op">=</span><span class="st">"red"</span>, add<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></code></pre></div>
<p><img src="bandwidth_files/figure-html/unnamed-chunk-4-1.png" width="700"></p>
</div>
<div id="conclusion" class="section level1">
<h1 class="hasAnchor">
<a href="#conclusion" class="anchor"></a>Conclusion</h1>
<p>Density estimation heavily relies on the choice of its bandwidth. In <span class="math inline">\(dbmss\)</span>, several choices influence its value. The first one is between the original, i.e. following <span class="citation">Duranton and Overman (2005)</span>, and the more acute algorithm by <span class="citation">Sheather and Jones (1991)</span>. Then, the distances taken into account, i.e. the argument <code>r</code> (actually, its maximum value) must be chosen carefully. A large <code>r</code> max value increases the bandwidth since distant pair points are taken into account. Decreasing <code>r</code> allows focusing on close neighbors: a smaller bandwidth will be used and the function estimations will be less smoothed, especially at small distances.</p>
<p>Last, the bandwidth can be arbitrarily modified by the <code>Adjust</code> argument if necessary.</p>
<p>The default values of arguments (especially <code>r</code>) are a good choice to obtain standard estimations of the <span class="math inline">\(K_d\)</span> and <span class="math inline">\(m\)</span> functions. If consistency with the original estimation of <span class="math inline">\(K_d\)</span> by <span class="citation">Duranton and Overman (2005)</span> is not important, <code>Original = FALSE</code> is even better. Whatever the user’s choices, the bandwidth is chosen the same way for the estimation of a distance-based function and its confidence envelope according to a null hypothesis, allowing to detect departures of the oberved data from the null hypothesis consistently.</p>
</div>
<div id="references" class="section level1 unnumbered">
<h1 class="hasAnchor">
<a href="#references" class="anchor"></a>References</h1>
<div id="refs" class="references">
<div id="ref-Duranton2005">
<p>Duranton, Gilles, and Henry G. Overman. 2005. “Testing for Localisation Using Micro-Geographic Data.” <em>Review of Economic Studies</em> 72 (4): 1077–1106.</p>
</div>
<div id="ref-Lang2014">
<p>Lang, Gabriel, Eric Marcon, and Florence Puech. 2014. “Distance-Based Measures of Spatial Concentration: Introducing a Relative Density Function.” <em>HAL</em> 01082178 (version 2).</p>
</div>
<div id="ref-Sheather1991">
<p>Sheather, S. J., and M. C. Jones. 1991. “A Reliable Data-Based Bandwidth Selection Method for Kernel Density Estimation.” <em>Journal of the Royal Statistical Society: Series B (Statistical Methodology)</em> 53 (3): 683–90.</p>
</div>
<div id="ref-Silverman1986">
<p>Silverman, B. W. 1986. <em>Density Estimation for Statistics and Data Analysis</em>. London: Chapman; Hall.</p>
</div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Eric Marcon, Gabriel Lang, Stephane Traissac, Florence Puech.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
</div>

  
<script src="https://cdnjs.cloudflare.com/ajax/libs/docsearch.js/2.6.1/docsearch.min.js" integrity="sha256-GKvGqXDznoRYHCwKXGnuchvKSwmx9SRMrZOTh2g4Sb0=" crossorigin="anonymous"></script><script>
  docsearch({
    
    
    apiKey: '34d07893d7877757953d7bd46f236a5e',
    indexName: 'dbmss',
    inputSelector: 'input#search-input.form-control',
    transformData: function(hits) {
      return hits.map(function (hit) {
        hit.url = updateHitURL(hit);
        return hit;
      });
    }
  });
</script>
</body>
</html>
